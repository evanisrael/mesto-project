(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{i8:()=>b,YS:()=>N,OP:()=>C,iW:()=>J,EG:()=>f,ER:()=>g,Ml:()=>D,NT:()=>L,HK:()=>k,RU:()=>E,JO:()=>q,_h:()=>A,x$:()=>h,Jx:()=>P,Kg:()=>v,LT:()=>j,BU:()=>O,rC:()=>x});var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-22",headers:{authorization:"b9b8ff59-f5f7-49b0-80ac-8e59386cec27","Content-Type":"application/json"}},n=function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},r=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},o=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",u),e.addEventListener("click",i)}function a(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",u),e.removeEventListener("click",i)}function u(e){"Escape"===e.key&&a(document.querySelector(".popup_opened"))}function i(e){var t=document.querySelector(".popup_opened");!t||e.target.closest(".popup__container")||e.target.closest(".popup__image-container")||a(t)}function s(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function l(e){if(e.target.classList.contains("element__trash-button")){var t=e.target.closest(".element"),r=t.dataset.cardId;n(r).then((function(){t.remove()})).catch((function(e){return console.error(e)}))}}function d(e){var t=e.target;if(t.classList.contains("element__button")){var n=t.closest(".element"),c=n.dataset.cardId;t.classList.contains("element__button_active")?o(c).then((function(e){t.classList.remove("element__button_active");var r=e.likes.length;n.querySelector(".element__like-number").textContent=r})).catch((function(e){return console.error(e)})):r(c).then((function(e){t.classList.add("element__button_active");var r=e.likes.length;n.querySelector(".element__like-number").textContent=r})).catch((function(e){return console.error(e)}))}}function p(e){var t=e.name,n=e.link,r=e.likes,o=e.owner,a=e._id,u=C.content.cloneNode(!0).querySelector(".element"),i=u.querySelector(".element__title"),s=u.querySelector(".element__image"),p=u.querySelector(".element__button"),m=u.querySelector(".element__trash-button"),_=u.querySelector(".element__like-number");return u.dataset.cardId=a,u.dataset.cardObject=JSON.stringify({name:t,link:n,likes:r,owner:o,_id:a}),i.textContent=t,s.src=n,s.alt=t,_.textContent=r.length,p.addEventListener("click",d),m.addEventListener("click",l),s.addEventListener("click",(function(e){e.stopPropagation(),function(e){var t=e.querySelector(".element__title").textContent,n=e.querySelector(".element__image").src;k.src=n,k.alt=t,E.textContent=t,c(L)}(u)})),function(e,t){t.style.visibility=e===D?"visible":"hidden"}(o._id,m),u}var m=document.querySelector(".page"),_=m.querySelector(".profile__edit-button"),f=m.querySelector("#edit"),v=m.querySelector("#popupName"),h=m.querySelector("#popupDescription"),y=f.querySelector(".popup__form"),S=m.querySelector(".profile__add-button"),b=m.querySelector("#add"),q=b.querySelector(".popup__form"),L=m.querySelector("#photo"),k=L.querySelector(".popup__image"),E=L.querySelector(".popup__image-text"),C=document.querySelector("#card-template"),g=document.querySelector(".elements__list"),j=document.querySelector("#popupTitle"),P=document.querySelector("#popupImageLink"),x=m.querySelector(".profile__name"),O=m.querySelector(".profile__description"),U=document.querySelectorAll(".popup__close-button"),T=document.querySelector(".profile__avatar"),B=document.querySelector(".profile__edit-avatar-button"),N=document.querySelector("#avatar"),A=N.querySelector(".popup__form"),D=null,J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);s(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){var r=t.dataset.errorText,o=t.validity.valid;t.setCustomValidity(t.validity.patternMismatch?r:""),o?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-input-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-input-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),s(n,r,t)}))}))}(t,e)}))}(J),_.addEventListener("click",(function(e){e.stopPropagation(),v.value=x.textContent,h.value=O.textContent,c(f)})),S.addEventListener("click",(function(e){e.stopPropagation(),c(b)})),B.addEventListener("click",(function(e){e.stopPropagation(),c(N)})),U.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return a(t)}))})),y.addEventListener("submit",(function(e){e.preventDefault();var n,r,o=f.querySelector(".popup__submit");o.value="Сохранение...",(n=v.value,r=h.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){x.textContent=e.name,O.textContent=e.about,a(f),o.value="Сохранить"})).catch((function(e){console.log(e)}))})),q.addEventListener("submit",(function(e){e.preventDefault();var n,r,o=b.querySelector(".popup__submit");o.value="Сохранение...",(n=j.value,r=P.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){var t=p(e);g.insertBefore(t,g.firstChild),a(b),q.reset(),o.value="Сохранить",o.disabled=!0,o.classList.add(J.inactiveButtonClass)})).catch((function(e){console.log(e)}))})),A.addEventListener("submit",(function(e){e.preventDefault();var n,r=N.querySelector(".popup__submit");r.value="Сохранение...",(n=N.querySelector(".popup__form").querySelector(".popup__input").value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){document.querySelector(".profile__avatar").src=e.avatar,a(N),r.value="Сохранить",A.reset()})).catch((function(e){console.error(e)}))})),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){x.textContent=e.name,O.textContent=e.about,T.src=e.avatar,D=e._id})).catch((function(e){return console.error(e)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.map(p).forEach((function(e){g.appendChild(e);var t=JSON.parse(e.dataset.cardObject),n=e.querySelector(".element__button");t.likes.map((function(e){return e._id})).includes(D)?n.classList.add("element__button_active"):n.classList.remove("element__button_active")}))})).catch((function(e){return console.error(e)}))})();